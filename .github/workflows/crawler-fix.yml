# .github/workflows/crawler-fix.yml

name: 'Article Fetcher Workflow'

on:
  push:
    branches:
      - main
      - master
  workflow_dispatch:

jobs:
  fetch:
    name: 'Fetch Pet Articles'
    runs-on: ubuntu-latest

    steps:
      - name: Check out repository
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm install

      # ==================================================
      # 여기가 핵심 수정사항입니다.
      # 1. TypeScript 컴파일: .ts 파일을 .js 파일로 변환합니다.
      #    프로젝트의 tsconfig.json 설정을 사용합니다.
      - name: Compile TypeScript script
        run: npx tsc scripts/fetch-articles.ts

      # 2. JavaScript 실행: 변환된 .js 파일을 node로 실행합니다.
      - name: Run the compiled script
        run: node scripts/fetch-articles.js
        env:
          NEWS_API_KEY: ${{ secrets.NEWS_API_KEY }}
      # ==================================================