# Pet-Life Magazine 개발일지 (Day 15)

**목표:** YOLOv8 모델(`best.pt`)을 웹 앱에 통합하여, 사용자가 영상을 업로드하고 AI 분석 결과를 확인할 수 있는 'AI 자세 분석' 기능을 완성한다.

## 📝 주요 개발 내용

### 1. 백엔드 API 구축 및 고도화 (FastAPI)
- **초기 구축:** `plan.md`에 계획된 대로 FastAPI 서버를 구축하고, `CORS` 및 정적 파일 서빙 설정을 추가하여 프론트엔드와의 연동 문제를 사전에 해결했다.
- **DB 연동:** Supabase와 연동하여 사용자별/강아지별 분석 기록을 저장할 `joint_analysis_records` 테이블을 신규 생성했다. 이 과정에서 `dogs` 테이블의 `id` 타입이 `uuid`임을 확인하고 스키마를 수정하여 데이터 정합성을 확보했다.
- **핵심 기능 구현:**
    - **'기준점(Baseline)' 개념 도입:** 특정 강아지의 첫 분석 결과를 `is_baseline=true`로 저장하여, 모든 미래 분석의 비교 기준으로 삼는 핵심 로직을 구현했다.
    - **핵심 지표 계산:** YOLO 분석 결과로부터 '안정성', '대칭성', '보폭' 등 의미 있는 지표를 계산하는 함수를 추가했다. (현재는 시뮬레이션 값)
- **안정성 확보:**
    - **비디오 코덱 문제 해결:** 초기 결과물인 `.avi`나 `mp4v` 코덱의 `.mp4` 파일이 웹 브라우저에서 재생되지 않는 문제를 발견했다. `OpenCV`를 사용하여, 웹에서 가장 널리 호환되는 **H.264 (`avc1`) 코덱**으로 영상을 자동 변환하는 로직을 추가하여 문제를 최종 해결했다.
    - **API 오류 처리 개선:** `supabase-py` 라이브러리 버전업에 따른 응답 객체 변경을 파악하고, `try...except APIError` 구문을 사용하여 DB 저장 오류 처리 로직을 안정적으로 수정했다.

### 2. 프론트엔드 UI/UX 개발 및 리팩토링 (React, shadcn/ui)
- **기능 명칭 확정:** 사용자의 직관적인 이해를 돕기 위해, 'AI 관절 추적' -> 'AI 보행 분석' -> **'AI 자세 분석'** 으로 최종 명칭을 확정했다.
- **페이지 역할 분담:**
    - **분석 페이지 (`PostureAnalysisPage`):** '빠른 실행과 즉각적인 요약 피드백' 역할로 한정했다. 분석 완료 후에는 상세 결과를 보여주는 대신, 완료 메시지와 함께 히스토리 페이지로 이동하는 버튼만 제공하도록 UI를 단순화했다.
    - **히스토리 페이지 (`PostureAnalysisHistoryPage`):** '상세 데이터 확인 및 변화 추적'의 유일한 창구로 역할을 명확히 했다.
- **데이터 동기화 문제 해결:**
    - 페이지 이동 시 데이터가 갱신되지 않는 문제를 해결하기 위해, `useState`/`useEffect` 기반의 데이터 로직을 **`React Query` (`useQuery`)** 기반으로 전면 리팩토링했다.
    - `useUserDogs`라는 새로운 훅을 만들어 여러 마리의 강아지를 지원하고, `useJointAnalysisHistory` 훅과 연동하여 항상 최신 데이터를 자동으로 동기화하도록 시스템을 개선했다.
- **네비게이션 구조 개선:**
    - **레이아웃 문제 해결:** 신규 페이지들이 `AppCore` 레이아웃 외부에서 렌더링되어 서브 네비게이션이 보이지 않는 문제를, `App.tsx`와 `Index.tsx`의 라우팅 구조를 수정하여 해결했다.
    - **서랍형 메뉴 구현:** `DropdownMenu`가 `overflow` 속성과 충돌하는 문제를 발견하고, `shadcn/ui`의 **`NavigationMenu`** 컴포넌트로 교체하여 더 세련되고 안정적인 서랍형 네비게이션을 최종 구현했다.

## ✅ 최종 성과
- 사용자가 영상을 업로드하여 AI 자세 분석을 실행하고, 그 결과가 웹 표준 영상 포맷(.mp4/H.264)으로 변환되어 DB에 사용자별/강아지별로 저장되며, 히스토리 페이지에서 항상 최신 데이터를 확인할 수 있는 **End-to-End 기능의 MVP를 성공적으로 완성했다.**
- 이 과정에서 발생한 백엔드(코덱, DB API)와 프론트엔드(데이터 동기화, 네비게이션)의 복합적인 문제들을 체계적으로 진단하고 해결하는 경험을 축적했다.
