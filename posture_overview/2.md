# 프로젝트 개요: AI 강아지 자세 분석 시스템 (V4 - UX 및 안정성 강화)

## 1. 최종 목표

-   **분석 신뢰도:** '척추 안정성' 기반의 고도화된 분석 엔진을 통해 신뢰도 높은 점수를 제공한다.
-   **사용자 경험:** 허깅페이스 서버의 Sleep 모드로 인한 업로드 실패 문제를 근본적으로 해결하여, 사용자에게 예측 가능하고 안정적인 분석 경험을 제공한다.
-   **기능 통합:** 분산된 기능을 통합하고, 모바일 가독성을 향상시켜 전반적인 서비스 품질을 높인다.

---

## 2. 구현된 기능 요약

### 2.1. AI 분석 엔진 (백엔드)

-   **안정성 분석 로직 고도화 (V2.1):**
    -   **척추 안정성 기반:** 몸통의 위치 이동이 아닌, '척추선'의 각도 유지를 측정하여 분석 정확도 향상.
    -   **안전 로직 강화:** 분석에 필요한 핵심 관절(어깨/엉덩이)이 일부 프레임에서 감지되지 않더라도, 프로세스가 중단되지 않도록 예외 처리 로직을 강화하여 안정성 확보.

### 2.2. 사용자 경험(UX) 및 안정성 (프론트엔드)

-   **업로드 UX '스마트 폴링' 도입:**
    -   **문제 해결:** 허깅페이스 서버��� Sleep 모드로 인해 발생하던 'fetch 오류' 및 불필요한 재업로드 문제를 근본적으로 해결.
    -   **작동 방식:** 실제 파일 업로드 전에 서버 상태를 먼저 확인(`Health Check`)하고, 서버가 준비되었을 때만 데이터를 전송하여 업로드 성공률을 극대화.
    -   **상세 피드백:** '서버 연결 중', 'AI 서버 깨우는 중' 등 현재 상태를 사용자에게 명확히 알려주어 대기 시간 동안의 불안감을 해소.
-   **페이지 이탈 방지:** 분석이 진행되는 동안 사용자가 실수로 페이지를 벗어나 작업이 중단되는 것을 방지하는 경고창 기능 추가.
-   **모바일 가독성 향상:** 주요 안내 문구에 `break-keep` 스타일을 적용하여, 모바일 환경에서 단어 단위의 줄바꿈이 이루어지도록 개선.

---

## 3. 기술적 구현 상세

### 3.1. 백엔드 (`main.py`)

-   **`GET /api/health` 엔드포인트 신설:**
    -   프론트엔드가 서버의 활성 상태를 확인할 수 있는 가벼운 '헬스 체크' 엔드포인트.
    -   서버를 Sleep 모드에서 깨우고, 업로드 가능 상태임을 알리는 역할을 담당.
-   **`calculate_stability_score` 함수 안정성 강화:**
    -   각 프레임의 키포인트 데이터 유효성을 검사하는 로직을 추가하여, 특정 관절이 누락되어도 전체 분석 프로세스가 중단되지 않도록 수정.

### 3.2. 프론트엔드 (`PostureAnalysisPage.tsx`)

-   **업로드 로직 리팩토링 (스마트 폴링):**
    1.  **상태 추가:** `connecting`, `waking_server` 등 세분화된 상태(Status)를 추가하여 UI 피드백을 구체화.
    2.  **헬스 체크 우선:** `handleAnalyzeClick` 함수는 이제 파일 업로드 대신 `/api/health`를 먼저 호출.
    3.  **조건부 폴링:**
        -   헬스 체크 실패 시(서버 Sleep), `pollServerHealth` 함수가 활성화되어 5초마다 서버 상태를 다시 확인.
        -   서버가 깨어나면, `uploadFileAndStartJob` 함수를 호출하여 실제 파일 업로드를 진행.
        -   업로드가 완료되면, 기존의 `pollJobStatus` 함수가 작업 진행률을 확인.
-   **페이지 이탈 방지 (`beforeunload` 이벤트):**
    -   분석 관련 상태(`connecting`, `waking_server` 등)일 때, 페이지 이탈 시도 시 "분석이 진행 중입니다. 페이지를 벗어나면 업로드가 중단될 수 있습니다..." 라는 경고 메시지를 표시.

---

## 4. 후속 조치 및 분석 로드맵

-   **카카오톡 공유 로직 완성:** 현재 `toast` 알림으로 처리된 `handleShareToKakao` 함수에 실제 공유 기능을 구현.
-   **신규 분석 지표 개�� (로드맵):**
    -   **보행 패턴 분석:** 걸음걸이의 리듬과 좌우 균형을 분석하여 절뚝거림 감지. (FFT, 피크 탐지 알고리즘 활용)
    -   **주요 관절 각도 분석:** 무릎/팔꿈치 관절의 가동 범위(Range of Motion)를 추적하여 관절 뻣뻣함 감지.
    -   **정적 자세 분류:** 앉기, 엎드리기 등 특정 자세를 자동으로 분류하고, 표준 자세와의 유사도 측정.
